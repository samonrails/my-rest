- billing_reference_group = (defined? params[:searchable][:billing_reference_group]) ? params[:searchable][:billing_reference_group] : ""

.section-header
%h1
  Billing Reference Report

%h4 
  Generated At: #{Time.now.strftime("%Y-%m-%d %I:%M:%S %p")}
  %br
  Generated By:
  - unless @current_user.nil?
    #{@current_user.name} (#{@current_user.email})
  %br
  Start Date:
  - unless defined?(params[:searchable][:event_start_time_from]).nil?
    #{params[:searchable][:event_start_time_from]}
  %br
  End Date:
  - unless defined?(params[:searchable][:event_start_time_to]).nil?
    #{params[:searchable][:event_start_time_to]}

%br

- if !@account.nil?
  - params[:searchable][:account] = nil if defined?(params[:searchable][:account])
  - events = Event.where(:account_id => @account.id).search_sort_paginate(params)
  - events = events.includes(:order).where("catering_orders.event_id is not null") if defined? params[:searchable][:order_method] and params[:searchable][:order_method] == "Self Service"
  = render partial: "billing_reference_report_table", locals: {billing_reference_group: billing_reference_group, events: events}

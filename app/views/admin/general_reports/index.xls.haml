.section-header
%h1 New Audience Report 

%h4 
  Generated At: #{Time.now.strftime("%Y-%m-%d %I:%M:%S %p")}
  %br
  Generated By:
  - unless @current_user.nil?
    #{@current_user.name} (#{@current_user.email})

%hr

.results
  %table
    %thead
      %tr
        %th Account
        %th Location Name
        %th Location Type
        %th Building Name
        %th Expected Participation
    %tbody
      - @accounts.each do |account|
        %tr{:style => "background: #87ceeb; font-weight: bold;"}
          %td= account.name
          %td
          %td
          %td
          %td= account.locations.inject(0) { |sum, l| sum + l.expected_participation }
        - account.locations.each do |location|
          %tr
            %td
            %td= location.name
            %td= location.location_type
            %td= location.building.name unless location.building.nil?
            %td= location.expected_participation
      %tr
        %td
      %tr{:style => "background: #A0A0A0; font-weight: bold;"}
        %td Total
        %td
        %td
        %td
        %td= @accounts.map {|a| a.locations }.flatten.inject(0) { |sum, l| sum + l.expected_participation }